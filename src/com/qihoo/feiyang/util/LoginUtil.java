package com.qihoo.feiyang.util;import java.io.BufferedInputStream;import java.io.IOException;import java.io.InputStream;import java.net.MalformedURLException;import java.net.URL;import java.net.URLConnection;import android.content.Context;import android.graphics.BitmapFactory;import android.util.Log;import com.qihoo.feiyang.R;import com.qihoo.yunpan.sdk.android.config.YunpanEnvironment;import com.qihoo.yunpan.sdk.android.config.YunpanSDKConfig;import com.qihoo.yunpan.sdk.android.config.YunpanSDKConstants;import com.qihoo.yunpan.sdk.android.http.action.UserGetUserDetail;import com.qihoo.yunpan.sdk.android.http.action.UserIntfLogin;import com.qihoo.yunpan.sdk.android.http.model.UserCenterInfo;import com.qihoo.yunpan.sdk.android.http.model.UserDetail;import com.qihoo.yunpan.sdk.android.http.model.UserLoginInfo;import com.qihoo.yunpan.sdk.android.model.IYunpanInterface;import com.qihoo.yunpan.sdk.android.task.LoginYunpanAction;public final class LoginUtil {	private static String TAG = "LoginUtil";			public static void setYunDiskAuth(Context context) {    	YunpanSDKConstants.setYunpanInterface((IYunpanInterface) context);		YunpanSDKConstants.AUTH_NAME = context.getResources().getString(R.string.authName);		YunpanSDKConstants.AUTH_KEY = context.getResources().getString(R.string.authKey);		YunpanSDKConstants.AUTH_SECRET = context.getResources().getString(R.string.authSecret);    }		public static boolean login(String userName, String passwd) {		UserCenterInfo cInfo = new UserIntfLogin().login(userName, passwd, "", ""); 		if (cInfo != null && cInfo.errno != null && cInfo.errno.equals(YunpanSDKConfig.RESULT_SUCCESS) 				&& cInfo.user != null && cInfo.user.qid != null) { 			UserLoginInfo login = new LoginYunpanAction().loginYunpan(cInfo.user.qid); 			if (login != null && login.errno != null && login.errno.equals(YunpanSDKConfig.RESULT_SUCCESS)) { 				System.out.println("用户登录成功"); 				DBUtil.saveQid(cInfo.user.qid); 				DBUtil.saveKey("username", userName); 				DBUtil.saveKey("password", passwd); 				 				return true; 			} else { 				System.out.println("用户登录失败"); 				return false; 			} 		} else { 			Log.d(TAG , cInfo.errno + "  " + cInfo.errmsg); 		} 		 		return false;	}		public static void clearUserEnvironment() {		String qid = YunpanEnvironment.Clear_YunpanEnvironment();		if (qid != null && !qid.equals("")) {			// 清除成功			System.out.println("clear user success");		}	}		public static boolean switchUserEnvironment(String qid) {		if (YunpanEnvironment.Switch_YunpanEnvironment(qid)) {	// 成功			System.out.println("switch user success");			return true;		} else {			// 失败			System.out.println("失败");			return false;		}				}		public static void getUserDetail(){				UserGetUserDetail ugud= new UserGetUserDetail();		UserDetail ud=ugud.getUserDetail();						URL avatarUrl=null;			try {				avatarUrl = new URL(ud.data.image_url);				URLConnection conn = avatarUrl.openConnection();				conn.connect();				InputStream is = conn.getInputStream();				BufferedInputStream bis = new BufferedInputStream(is);				GlobalsUtil.mainAvatar=BitmapFactory.decodeStream(bis);				bis.close();				is.close();			} catch (MalformedURLException e) {				// TODO Auto-generated catch block				e.printStackTrace();			} catch (IOException e) {				// TODO Auto-generated catch block				e.printStackTrace();			}											long used=ud.data.used_size/(1024*1024);  //M		if(used>1024)			GlobalsUtil.usedSize=used/1024 + "G";		else{			if(used>1024*1024)				GlobalsUtil.usedSize=used/1024/1024 + "T";			else				GlobalsUtil.usedSize=used + "M";					}				long total=ud.data.total_size/(1024*1024*1024); //G		if(total<1)			GlobalsUtil.totalSize=total*1024 + "M";		else{			if(total>1024)				GlobalsUtil.totalSize=total/1024 + "T";			else				GlobalsUtil.totalSize=total + "G";					}				GlobalsUtil.nickName=ud.data.nickName;					}	}